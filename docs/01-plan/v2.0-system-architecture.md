# AJU E&J í•™ìƒê´€ë¦¬ í”Œë«í¼ v2.1 - ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (Production-Ready)

> **ì‘ì„±ì¼**: 2026-02-15
> **ì—…ë°ì´íŠ¸**: 2026-02-15 (v2.1 ì™„ì „íŒ)
> **ë²„ì „**: 2.1 (Complete Edition)
> **ë‹´ë‹¹**: Claude AI
> **ëª©í‘œ**: v2.0 + ë™ì‹œì„±ì œì–´ + ëª¨ë°”ì¼ + Excel + ë³´ì•ˆê°•í™” + ë°±ì—… + ëŒ€ì‹œë³´ë“œ + ê²€ìƒ‰ + ì¼ê´„ì‘ì—… + íŒŒì¼ì²¨ë¶€ + ì•Œë¦¼ + ë¡œê·¸ì •ë¦¬ + ê²€ì¦ + APIë¬¸ì„œ (14ê°œ ì‹ ê·œ ê¸°ëŠ¥)

---

## 1. ì‹œìŠ¤í…œ ê°œìš” (System Overview)

### 1.1 í•µì‹¬ ë³€ê²½ ì‚¬í•­ (v1.0 â†’ v2.0 â†’ v2.1)

| í•­ëª© | v1.0 | v2.0 | v2.1 (Production-Ready) |
|------|------|------|------------------------|
| **ì‹œíŠ¸ ìˆ˜** | 8ê°œ | 11ê°œ | **14ê°œ** (Sequences, FileAttachments, Trash_Students ì¶”ê°€) |
| **ì‚¬ìš©ì ë“±ê¸‰** | 2ë‹¨ê³„ (master, agency) | **3ë‹¨ê³„** (master, agency, student) | ë™ì¼ |
| **ì¸ì¦ ë°©ì‹** | Agencies ì‹œíŠ¸ ê¸°ë°˜ | **Users ì‹œíŠ¸ í†µí•© ì¸ì¦** | ë™ì¼ |
| **í•™ìƒ ê°€ì…** | âŒ ë¶ˆê°€ëŠ¥ (êµì‚¬ë§Œ ë“±ë¡) | âœ… **í•™ìƒ ìì²´ íšŒì›ê°€ì…** | ë™ì¼ |
| **ì´ë©”ì¼ ê¸°ëŠ¥** | âŒ ì—†ìŒ | âœ… **ID/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°, ì •ê¸° ì•Œë¦¼** | âœ… + **ì•Œë¦¼ ì„¤ì • ì œì–´** |
| **ê°œì¸ì •ë³´ë³´í˜¸** | âŒ ë¯¸ì¤€ìˆ˜ | âœ… **ë™ì˜ ê¸°ë¡, ì •ê¸° ì•Œë¦¼** | ë™ì¼ |
| **ë™ì‹œì„± ì œì–´** | âŒ Race Condition ê°€ëŠ¥ | âŒ ë¯¸êµ¬í˜„ | âœ… **LockService (ìˆœë²ˆ ì¶©ëŒ ë°©ì§€)** |
| **ëª¨ë°”ì¼ ì§€ì›** | âŒ PC ì „ìš© | âŒ PC ì „ìš© | âœ… **ë°˜ì‘í˜• UI (320px~1440px) + PWA** |
| **Excel ê´€ë¦¬** | âŒ ì—†ìŒ | âŒ ì—†ìŒ | âœ… **ê¶Œí•œë³„ Import/Export** |
| **ë°ì´í„° ë°±ì—…** | âŒ ìˆ˜ë™ | âŒ ìˆ˜ë™ | âœ… **ìë™ ë°±ì—… (ë§¤ì¼ 2AM) + ë³µêµ¬** |
| **ê²€ìƒ‰ ê¸°ëŠ¥** | ê¸°ë³¸ | ê¸°ë³¸ | âœ… **í†µí•© ê²€ìƒ‰ + ìë™ì™„ì„± + í•„í„°** |
| **ëŒ€ì‹œë³´ë“œ** | âŒ ì—†ìŒ | âŒ ì—†ìŒ | âœ… **í†µê³„ + ì°¨íŠ¸ (Chart.js)** |
| **ì¼ê´„ ì‘ì—…** | âŒ ê°œë³„ë§Œ | âŒ ê°œë³„ë§Œ | âœ… **ì¼ê´„ ìˆ˜ì •/ì‚­ì œ + íœ´ì§€í†µ** |
| **íŒŒì¼ ì²¨ë¶€** | âŒ ì—†ìŒ | âŒ ì—†ìŒ | âœ… **Google Drive ì—°ë™** |
| **ë³´ì•ˆ ê°•í™”** | ê¸°ë³¸ | ê¸°ë³¸ | âœ… **Rate Limiting + XSS/CSRF ë°©ì§€** |

### 1.2 ì‹ ê·œ ê¸°ëŠ¥ (v2.0 Features)

1. **í•™ìƒ íšŒì›ê°€ì… ì‹œìŠ¤í…œ**
   - í•™ìƒì´ ì§ì ‘ ID/ë¹„ë°€ë²ˆí˜¸ ìƒì„±
   - ì´ë©”ì¼ ì¸ì¦ ì½”ë“œ (6ìë¦¬)
   - ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë™ì˜ í•„ìˆ˜

2. **ì´ë©”ì¼ ê¸°ë°˜ ê³„ì • ë³µêµ¬**
   - ID ì°¾ê¸° (ì´ë©”ì¼ë¡œ ID ì „ì†¡)
   - ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • (ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ë°œì†¡)

3. **ê°œì¸ì •ë³´ë³´í˜¸ë²• ì¤€ìˆ˜**
   - íšŒì›ê°€ì… ì‹œ ê°œì¸ì •ë³´ ë™ì˜ ê¸°ë¡
   - 6ê°œì›”ë§ˆë‹¤ ê°œì¸ì •ë³´ ì´ìš© ì•Œë¦¼ ì´ë©”ì¼ ìë™ ë°œì†¡
   - ê°œì¸ì •ë³´ ì—´ëŒ/ìˆ˜ì •/ì‚­ì œ ê¶Œë¦¬ ë³´ì¥

4. **ê°ì‚¬ ì¶”ì  ê°•í™”**
   - ëª¨ë“  ì´ë©”ì¼ ë°œì†¡ ê¸°ë¡ (EmailLogs)
   - ëª¨ë“  ê°œì¸ì •ë³´ ë™ì˜ ê¸°ë¡ (PrivacyConsents)

### 1.3 ì‹ ê·œ ê¸°ëŠ¥ (v2.1 Production-Ready Features) - 14ê°œ

5. **ë™ì‹œì„± ì œì–´ (Race Condition Prevention)**
   - LockService ì‚¬ìš© (GAS Native)
   - Sequences ì‹œíŠ¸ (ìˆœë²ˆ Atomic Increment)
   - StudentID ìƒì„± ì¶©ëŒ 100% ë°©ì§€

6. **ëª¨ë°”ì¼ ë°˜ì‘í˜• UI + PWA**
   - Mobile First ë””ìì¸ (320px~1440px)
   - PWA manifest.json (í™ˆ í™”ë©´ ì¶”ê°€)
   - í„°ì¹˜ ì¹œí™”ì  UI (ë²„íŠ¼ 44px ì´ìƒ)

7. **Excel Import/Export (ê¶Œí•œë³„)**
   - Master: ëª¨ë“  ì‹œíŠ¸ Import/Export
   - Agency: ì†Œì† í•™ìƒë§Œ
   - Student: ì ‘ê·¼ ë¶ˆê°€

8. **ë¹„ê³ ë€ (Notes) ì¶”ê°€**
   - Students.Notes (ìµœëŒ€ 50,000ì)
   - Consultations.PrivateNotes
   - ê¶Œí•œ: Master, Agency (Student ìˆ¨ê¹€)

9. **ë³´ì•ˆ ê°•í™”**
   - API Rate Limiting (1ë¶„ 100íšŒ)
   - XSS ë°©ì§€ (HTML íƒœê·¸ ì œê±°)
   - CSRF ë°©ì§€ (ì„¸ì…˜ í† í° ê²€ì¦)
   - HTTPS ê°•ì œ

10. **ë°ì´í„° ë°±ì—…/ë³µêµ¬**
    - ìë™ ë°±ì—… (ë§¤ì¼ ìƒˆë²½ 2ì‹œ)
    - Google Drive ì €ì¥ (30ì¼ ë³´ê´€)
    - Master ì „ìš© ë³µêµ¬ UI

11. **ê²€ìƒ‰ ê¸°ëŠ¥ ê°•í™”**
    - í†µí•© ê²€ìƒ‰ (ì´ë¦„/ID/ì „í™”/ì´ë©”ì¼)
    - ìë™ì™„ì„± (ìµœê·¼ ê²€ìƒ‰ 5ê°œ)
    - í•„í„°ë§ (ìœ í•™ì›/ìƒíƒœ/ì—°ë„/TOPIK)

12. **ëŒ€ì‹œë³´ë“œ (í†µê³„ + ì‹œê°í™”)**
    - Chart.js ì°¨íŠ¸ (íŒŒì´/ë§‰ëŒ€/ì„ )
    - í•™ìƒ ìˆ˜ í†µê³„ (ìœ í•™ì›ë³„/ìƒíƒœë³„)
    - TOPIK ì„±ì  í†µê³„ (ë“±ê¸‰ë³„/í‰ê· )
    - ë¹„ì ë§Œë£Œ ì•Œë¦¼ (30ì¼ ì´ë‚´)

13. **ì¼ê´„ ì‘ì—… (Bulk Operations)**
    - ì¼ê´„ ìˆ˜ì •/ì‚­ì œ (ì²´í¬ë°•ìŠ¤ ì„ íƒ)
    - Excel ì¼ê´„ ë“±ë¡ (ìµœëŒ€ 500ëª…)
    - íœ´ì§€í†µ ê¸°ëŠ¥ (30ì¼ ë³´ê´€)

14. **íŒŒì¼ ì²¨ë¶€ (Google Drive ì—°ë™)**
    - í•™ìƒë³„ í´ë” ìë™ ìƒì„±
    - íŒŒì¼ ì—…ë¡œë“œ (PDF/JPG/PNG/DOCX, ìµœëŒ€ 10MB)
    - ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì§€ì›

15. **ì•Œë¦¼ ì„¤ì • (Notification Settings)**
    - ì‚¬ìš©ìë³„ On/Off ì œì–´
    - ë¹„ìë§Œë£Œ/ê°œì¸ì •ë³´/ì‹œí—˜/ìƒë‹´/ê³µì§€
    - NotificationPreferences (JSON)

16. **ë¡œê·¸ ìë™ ì •ë¦¬ (Log Cleanup)**
    - ì¼ë°˜ ë¡œê·¸: 1ë…„ ë³´ê´€
    - ì¤‘ìš” ë¡œê·¸: ì˜êµ¬ ë³´ê´€
    - ì—ëŸ¬ ë¡œê·¸: 6ê°œì›” ë³´ê´€
    - ìë™ ì •ë¦¬ (ë§¤ì›” 1ì¼ ìƒˆë²½ 3ì‹œ)

17. **ë°ì´í„° ê²€ì¦ ê°•í™” (Validation)**
    - ìƒë…„ì›”ì¼/ì „í™”ë²ˆí˜¸/ì´ë©”ì¼ ê²€ì¦
    - ì¤‘ë³µ í™•ì¸ (ì‹¤ì‹œê°„)
    - í•„ìˆ˜ í•„ë“œ ê²€ì¦

18. **API ë¬¸ì„œ ìë™ ìƒì„±**
    - JSDoc ì£¼ì„ â†’ Swagger UI
    - REST API ìŠ¤í™ JSON
    - /api-docs ì ‘ê·¼ ê°€ëŠ¥

---

## 2. ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° (14 Sheets)

### 2.1 ì „ì²´ ì‹œíŠ¸ ëª©ë¡

| # | Sheet | Purpose | v1.0 | v2.0 | v2.1 |
|---|-------|---------|------|------|------|
| 1 | **Users** | í†µí•© ì¸ì¦ (master/agency/student) | âŒ | ğŸ†• | âšª |
| 2 | Students | í•™ìƒ ê¸°ë³¸ ì •ë³´ (Notes ì¶”ê°€) | âšª | âœï¸ | âœï¸ |
| 3 | Agencies | ìœ í•™ì› ì •ë³´ | âšª | âœï¸ | âšª |
| 4 | Consultations | ìƒë‹´ ê¸°ë¡ (PrivateNotes ì¶”ê°€) | âšª | âšª | âœï¸ |
| 5 | ExamResults | TOPIK ì‹œí—˜ ì„±ì  | âšª | âšª | âšª |
| 6 | TargetHistory | ëª©í‘œëŒ€í•™ ë³€ê²½ ì´ë ¥ | âšª | âšª | âšª |
| 7 | **PrivacyConsents** | ê°œì¸ì •ë³´ ë™ì˜ ê¸°ë¡ | âŒ | ğŸ†• | âšª |
| 8 | **EmailLogs** | ì´ë©”ì¼ ë°œì†¡ ê¸°ë¡ | âŒ | ğŸ†• | âšª |
| 9 | **Sequences** | ì‹œí€€ìŠ¤ ê´€ë¦¬ (Race Condition ë°©ì§€) | âŒ | âŒ | ğŸ†• |
| 10 | **FileAttachments** | íŒŒì¼ ì²¨ë¶€ ê´€ë¦¬ | âŒ | âŒ | ğŸ†• |
| 11 | **Trash_Students** | í•™ìƒ íœ´ì§€í†µ (30ì¼ ë³´ê´€) | âŒ | âŒ | ğŸ†• |
| 12 | AuditLogs | ê°ì‚¬ ê¸°ë¡ | âšª | âœï¸ | âšª |
| 13 | SystemConfig | ì‹œìŠ¤í…œ ì„¤ì • (KR/VN) | âšª | âœï¸ | âšª |
| 14 | i18n | ë‹¤êµ­ì–´ ì‚¬ì „ | âšª | âšª | âšª |

**ì‹ ê·œ ì‹œíŠ¸ ìƒì„¸ (v2.1)**:

#### Sequences ì‹œíŠ¸
- **ëª©ì **: StudentID ìƒì„± ì‹œ ìˆœë²ˆ Atomic Increment (Race Condition ë°©ì§€)
- **í•„ë“œ**: EntityType, LastSequence (1, 2, 3, ...), UpdatedAt, UpdatedBy
- **ì¤‘ìš”**: LastSequenceëŠ” 1ë¶€í„° ì‹œì‘ (ì²« ë²ˆì§¸ í•™ìƒ = 1 â†’ í’€ ID: 260010001)

#### FileAttachments ì‹œíŠ¸
- **ëª©ì **: í•™ìƒë³„ ì²¨ë¶€ íŒŒì¼ ê´€ë¦¬ (ì¦ëª…ì„œ, ì‚¬ì§„, ì„œë¥˜)
- **í•„ë“œ**: FileID, StudentID, FileName, FileCategory, DriveFileID, FileSize, UploadedBy, UploadedAt
- **íŒŒì¼**: PDF/JPG/PNG/DOCX, ìµœëŒ€ 10MB

#### Trash_Students ì‹œíŠ¸
- **ëª©ì **: ì‚­ì œëœ í•™ìƒ ë°ì´í„° 30ì¼ ë³´ê´€ (ë³µêµ¬ ê°€ëŠ¥)
- **í•„ë“œ**: Students ì‹œíŠ¸ì™€ ë™ì¼ + DeletedAt ì»¬ëŸ¼
- **ìë™ ì •ë¦¬**: 30ì¼ ê²½ê³¼ ì‹œ ì˜êµ¬ ì‚­ì œ

### 2.2 Entity Relationship Diagram (v2.0)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Users (í†µí•© ì¸ì¦)                            â”‚
â”‚  - UserID (PK): MASTER / AgencyCode / STU{StudentID}              â”‚
â”‚  - UserType: master / agency / student                            â”‚
â”‚  - LoginID, Email, PasswordHash                                   â”‚
â”‚  - PrivacyConsentDate, LastPrivacyNotice                          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                â”‚                        â”‚
     â”‚ 1:1                            â”‚ 1:1                    â”‚ 1:N
     â–¼                                â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Students    â”‚              â”‚   Agencies   â”‚       â”‚PrivacyConsents  â”‚
â”‚  (í•™ìƒ ì •ë³´)  â”‚              â”‚  (ìœ í•™ì› ì •ë³´) â”‚       â”‚(ê°œì¸ì •ë³´ ë™ì˜)   â”‚
â”‚              â”‚              â”‚              â”‚       â”‚                 â”‚
â”‚ - StudentID  â”‚              â”‚ - AgencyCode â”‚       â”‚ - ConsentID     â”‚
â”‚ - UserID(FK) â”‚              â”‚ - UserID(FK) â”‚       â”‚ - UserID (FK)   â”‚
â”‚ - AgencyCode â”‚              â”‚              â”‚       â”‚ - ConsentType   â”‚
â”‚ - NameKR/VN  â”‚              â”‚              â”‚       â”‚ - ConsentDate   â”‚
â”‚ - ...        â”‚              â”‚              â”‚       â”‚ - ExpiryDate    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:N                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  Consultations  â”‚
       â”‚                                             â”‚ (ìƒë‹´ ê¸°ë¡)       â”‚
       â”‚                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:N                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  ExamResults    â”‚
       â”‚                                             â”‚ (TOPIK ì„±ì )     â”‚
       â”‚                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:N                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ TargetHistory   â”‚
                                                     â”‚ (ëª©í‘œëŒ€í•™ ì´ë ¥)   â”‚
                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   EmailLogs     â”‚       â”‚  AuditLogs   â”‚       â”‚     i18n     â”‚
â”‚ (ì´ë©”ì¼ ë°œì†¡)     â”‚       â”‚ (ê°ì‚¬ ê¸°ë¡)    â”‚       â”‚ (ë‹¤êµ­ì–´ ì‚¬ì „)  â”‚
â”‚                 â”‚       â”‚              â”‚       â”‚              â”‚
â”‚ - EmailID       â”‚       â”‚ - LogID      â”‚       â”‚ - Key        â”‚
â”‚ - UserID (FK)   â”‚       â”‚ - UserID     â”‚       â”‚ - KO_Text    â”‚
â”‚ - EmailType     â”‚       â”‚ - Action     â”‚       â”‚ - VI_Text    â”‚
â”‚ - Status        â”‚       â”‚ - Timestamp  â”‚       â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘                          â†‘
     â”‚ 1:N                      â”‚ ëª¨ë“  ì‹œíŠ¸ì—ì„œ ê¸°ë¡
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        (Users ì‹œíŠ¸ ì°¸ì¡°)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SystemConfig â”‚
â”‚ (ì‹œìŠ¤í…œ ì„¤ì •)  â”‚
â”‚              â”‚
â”‚ - ConfigKey  â”‚
â”‚ - ValueKR    â”‚
â”‚ - ValueVI    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  (ë…ë¦½ - ì„¤ì •ê°’)
```

### 2.3 Smart ID Generation Rules

#### StudentID Format (v2.1 ëª…í™•í™”)

**ì¤‘ìš”**: StudentIDëŠ” ì´ **9ìë¦¬ í’€ ID**ì…ë‹ˆë‹¤.

```
Format: YYAAASSSSS (9ìë¦¬)
        â””â”¬â”˜â””â”€â”¬â”€â”˜â””â”€â”€â”¬â”€â”€â”˜
         â”‚   â”‚     â””â”€ SSSS: ìˆœë²ˆ 4ìë¦¬ (0001, 0002, 0003, ...)
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€ AAA: ìœ í•™ì› ë²ˆí˜¸ 3ìë¦¬ (001, 002, 003, ...)
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ YY: ì—°ë„ 2ìë¦¬ (26, 27, 28, ...)
```

**ìƒì„± ë¡œì§ (Race Condition Safe)**:
1. ì—°ë„ ì¶”ì¶œ: 2026 â†’ 26
2. ìœ í•™ì› ë²ˆí˜¸: HANOI â†’ 001
3. **Sequences ì‹œíŠ¸**ì—ì„œ ìˆœë²ˆ ì¡°íšŒ (EntityType = StudentID_26001)
4. ìˆœë²ˆ + 1 (ì˜ˆ: 0 + 1 = 1, 1 + 1 = 2, ...)
5. ìˆœë²ˆì„ 4ìë¦¬ë¡œ íŒ¨ë”©: 1 â†’ 0001, 2 â†’ 0002
6. **9ìë¦¬ í’€ ID ì¡°í•©**: 26 + 001 + 0001 = **260010001**
7. **Students ì‹œíŠ¸ì— í’€ ID ì €ì¥**: 260010001
   (âš ï¸ Sequences ì‹œíŠ¸ëŠ” ìˆœë²ˆ 1ë§Œ ì €ì¥, "2611" ê°™ì€ ë¶€ë¶„ IDëŠ” ì ˆëŒ€ ì €ì¥ ì•ˆ ë¨)

**ì˜ˆì‹œ**:
- ì²« ë²ˆì§¸: `260010001` (26 + 001 + 0001) â†’ Sequences LastSequence = 1
- ë‘ ë²ˆì§¸: `260010002` (26 + 001 + 0002) â†’ Sequences LastSequence = 2
- ì„¸ ë²ˆì§¸: `260010003` (26 + 001 + 0003) â†’ Sequences LastSequence = 3

#### Other ID Formats

| Entity | Format | Example | ìƒì„± ê·œì¹™ |
|--------|--------|---------|----------|
| **UserID (master)** | MASTER | `MASTER` | ê³ ì •ê°’ |
| **UserID (agency)** | AgencyCode | `HANOI` | ìœ í•™ì› ì½”ë“œ ê·¸ëŒ€ë¡œ |
| **UserID (student)** | STU{StudentID} | `STU260010001` | "STU" + 9ìë¦¬ StudentID |
| ConsentID | CONSENT-YYYYMMDD-SEQ | `CONSENT-20260115-001` | ë‚ ì§œ + ìˆœë²ˆ |
| EmailID | EMAIL-YYYYMMDD-SEQ | `EMAIL-20260115-001` | ë‚ ì§œ + ìˆœë²ˆ |
| FileID | FILE-YYYYMMDD-SEQ | `FILE-20260215-001` | ë‚ ì§œ + ìˆœë²ˆ |

---

## 3. íŒŒì¼ êµ¬ì¡° (File Structure)

### 3.1 Backend (GAS Files)

```
src/
â”œâ”€â”€ Code.gs                      # ë©”ì¸ ì§„ì…ì  (doGet, include)
â”œâ”€â”€ Config.gs                    # ì„¤ì • ìƒìˆ˜ ë° ì‹œíŠ¸ ì°¸ì¡°
â”‚
â”œâ”€â”€ Auth.gs                      # ì¸ì¦/ê¶Œí•œ ê´€ë¦¬
â”‚   â””â”€â”€ login(), logout(), checkSession()
â”‚   â””â”€â”€ _validateSession(), _createSession()
â”‚   â””â”€â”€ checkPermission()
â”‚
â”œâ”€â”€ SignupService.gs            # ğŸ†• v2.0 íšŒì›ê°€ì… ì„œë¹„ìŠ¤
â”‚   â””â”€â”€ signupStudent()         # í•™ìƒ íšŒì›ê°€ì…
â”‚   â””â”€â”€ sendVerificationEmail() # ì´ë©”ì¼ ì¸ì¦ ì½”ë“œ ë°œì†¡
â”‚   â””â”€â”€ verifyEmail()           # ì´ë©”ì¼ ì¸ì¦ í™•ì¸
â”‚
â”œâ”€â”€ EmailService.gs             # ğŸ†• v2.0 ì´ë©”ì¼ ë°œì†¡ ì„œë¹„ìŠ¤
â”‚   â””â”€â”€ sendWelcomeEmail()      # ê°€ì… ì™„ë£Œ ì´ë©”ì¼
â”‚   â””â”€â”€ sendPasswordReset()     # ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ë°œì†¡
â”‚   â””â”€â”€ sendIDRecovery()        # ID ì°¾ê¸° ì´ë©”ì¼
â”‚   â””â”€â”€ sendPrivacyNotice()     # ì •ê¸° ê°œì¸ì •ë³´ ì•Œë¦¼ (6ê°œì›”ë§ˆë‹¤)
â”‚   â””â”€â”€ _sendEmail()            # ê³µí†µ ì´ë©”ì¼ ë°œì†¡ ë¡œì§
â”‚
â”œâ”€â”€ PrivacyService.gs           # ğŸ†• v2.0 ê°œì¸ì •ë³´ ê´€ë¦¬ ì„œë¹„ìŠ¤
â”‚   â””â”€â”€ recordConsent()         # ê°œì¸ì •ë³´ ë™ì˜ ê¸°ë¡
â”‚   â””â”€â”€ checkConsentExpiry()    # ë™ì˜ ë§Œë£Œ í™•ì¸
â”‚   â””â”€â”€ sendConsentRenewal()    # ì¬ë™ì˜ ìš”ì²­ ì´ë©”ì¼
â”‚   â””â”€â”€ getPrivacyPolicy()      # ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ ì¡°íšŒ
â”‚
â”œâ”€â”€ SequenceService.gs          # ğŸ†• v2.1 ì‹œí€€ìŠ¤ ê´€ë¦¬ (Race Condition ë°©ì§€)
â”‚   â””â”€â”€ getNextSequence()       # Atomic Increment
â”‚   â””â”€â”€ generateStudentIDSafe() # StudentID ì•ˆì „ ìƒì„±
â”‚
â”œâ”€â”€ BackupService.gs            # ğŸ†• v2.1 ë°ì´í„° ë°±ì—…/ë³µêµ¬
â”‚   â””â”€â”€ autoBackup()            # ìë™ ë°±ì—… (GAS Trigger)
â”‚   â””â”€â”€ getBackupList()         # ë°±ì—… ëª©ë¡ ì¡°íšŒ
â”‚   â””â”€â”€ restoreBackup()         # ë°±ì—… ë³µêµ¬ (Master ì „ìš©)
â”‚
â”œâ”€â”€ SearchService.gs            # ğŸ†• v2.1 ê²€ìƒ‰ ì„œë¹„ìŠ¤
â”‚   â””â”€â”€ searchStudents()        # í†µí•© ê²€ìƒ‰
â”‚   â””â”€â”€ autocompleteStudentNames() # ìë™ì™„ì„±
â”‚
â”œâ”€â”€ DashboardService.gs         # ğŸ†• v2.1 ëŒ€ì‹œë³´ë“œ
â”‚   â””â”€â”€ getDashboardData()      # í†µê³„ ë°ì´í„° ì¡°íšŒ
â”‚   â””â”€â”€ getStudentStats()       # í•™ìƒ ìˆ˜ í†µê³„
â”‚   â””â”€â”€ getTopikStats()         # TOPIK ì„±ì  í†µê³„
â”‚   â””â”€â”€ getVisaExpiryAlerts()   # ë¹„ì ë§Œë£Œ ì•Œë¦¼
â”‚
â”œâ”€â”€ BulkOperationsService.gs    # ğŸ†• v2.1 ì¼ê´„ ì‘ì—…
â”‚   â””â”€â”€ bulkUpdateStudents()    # ì¼ê´„ ìˆ˜ì •
â”‚   â””â”€â”€ bulkDeleteStudents()    # ì¼ê´„ ì‚­ì œ (íœ´ì§€í†µ)
â”‚
â”œâ”€â”€ FileAttachmentService.gs    # ğŸ†• v2.1 íŒŒì¼ ì²¨ë¶€
â”‚   â””â”€â”€ uploadFile()            # íŒŒì¼ ì—…ë¡œë“œ (Drive)
â”‚   â””â”€â”€ getFileList()           # íŒŒì¼ ëª©ë¡ ì¡°íšŒ
â”‚
â”œâ”€â”€ NotificationSettingsService.gs # ğŸ†• v2.1 ì•Œë¦¼ ì„¤ì •
â”‚   â””â”€â”€ getNotificationSettings()  # ì•Œë¦¼ ì„¤ì • ì¡°íšŒ
â”‚   â””â”€â”€ updateNotificationSettings() # ì•Œë¦¼ ì„¤ì • ì—…ë°ì´íŠ¸
â”‚
â”œâ”€â”€ LogCleanupService.gs        # ğŸ†• v2.1 ë¡œê·¸ ìë™ ì •ë¦¬
â”‚   â””â”€â”€ cleanupOldLogs()        # ì˜¤ë˜ëœ ë¡œê·¸ ì •ë¦¬ (GAS Trigger)
â”‚
â”œâ”€â”€ ValidationService.gs        # ğŸ†• v2.1 ë°ì´í„° ê²€ì¦
â”‚   â””â”€â”€ validateDateOfBirth()   # ìƒë…„ì›”ì¼ ê²€ì¦
â”‚   â””â”€â”€ validatePhoneNumber()   # ì „í™”ë²ˆí˜¸ ê²€ì¦
â”‚   â””â”€â”€ validateEmail()         # ì´ë©”ì¼ ê²€ì¦
â”‚
â”œâ”€â”€ RateLimitService.gs         # ğŸ†• v2.1 Rate Limiting
â”‚   â””â”€â”€ checkRateLimit()        # API í˜¸ì¶œ íšŸìˆ˜ ì œí•œ
â”‚
â”œâ”€â”€ ExcelService.gs             # ğŸ†• v2.1 Excel Import/Export
â”‚   â””â”€â”€ exportStudentsToExcel() # Excel ë‚´ë³´ë‚´ê¸°
â”‚   â””â”€â”€ importStudentsFromExcel() # Excel ë¶ˆëŸ¬ì˜¤ê¸°
â”‚
â”œâ”€â”€ StudentService.gs           # í•™ìƒ CRUD ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â””â”€â”€ getStudentList()
â”‚   â””â”€â”€ getStudentById()
â”‚   â””â”€â”€ createStudent()
â”‚   â””â”€â”€ updateStudent()
â”‚   â””â”€â”€ deleteStudent()
â”‚
â”œâ”€â”€ ConsultService.gs           # ìƒë‹´ ê¸°ë¡ ê´€ë¦¬
â”œâ”€â”€ ExamService.gs              # TOPIK ì‹œí—˜ ì„±ì  ê´€ë¦¬
â”œâ”€â”€ AdminService.gs             # í–‰ì • ì •ë³´ (ë¹„ì, ë“±ë¡ì¦ ë“±)
â”‚
â”œâ”€â”€ I18nService.gs              # ë‹¤êµ­ì–´ ì—”ì§„
â”‚   â””â”€â”€ getLocaleStrings()
â”‚   â””â”€â”€ translateKey()
â”‚
â”œâ”€â”€ AuditService.gs             # ê°ì‚¬ ë¡œê·¸ ê¸°ë¡
â”‚   â””â”€â”€ _saveAuditLog()
â”‚
â””â”€â”€ Helpers.gs                  # ìœ í‹¸ë¦¬í‹°
    â””â”€â”€ generateUserID()
    â””â”€â”€ hashPassword()
    â””â”€â”€ encryptData(), decryptData()
    â””â”€â”€ formatDate()
    â””â”€â”€ isValidFileExtension()
    â””â”€â”€ exportSheetToExcel()
```

**ì´ Backend íŒŒì¼ ìˆ˜**: v1.0 (8ê°œ) â†’ v2.0 (11ê°œ) â†’ v2.1 (25ê°œ)

### 3.2 Frontend (HTML Files)

```
src/
â”œâ”€â”€ Index.html              # ë©”ì¸ í˜ì´ì§€ (SPA ì»¨í…Œì´ë„ˆ)
â”œâ”€â”€ Login.html              # ë¡œê·¸ì¸ í˜ì´ì§€
â”œâ”€â”€ Signup.html             # ğŸ†• í•™ìƒ íšŒì›ê°€ì… í˜ì´ì§€
â”œâ”€â”€ ForgotPassword.html     # ğŸ†• ID/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° í˜ì´ì§€
â”‚
â”œâ”€â”€ Stylesheet.html         # CSS ìŠ¤íƒ€ì¼ì‹œíŠ¸
â”œâ”€â”€ JavaScript.html         # ê³µí†µ JS ë¡œì§
â”œâ”€â”€ I18nClient.html         # ë‹¤êµ­ì–´ í´ë¼ì´ì–¸íŠ¸ ë¡œì§
â””â”€â”€ Components.html         # ì¬ì‚¬ìš© UI ì»´í¬ë„ŒíŠ¸
```

### 3.3 Documentation (docs/)

```
docs/
â”œâ”€â”€ 01-plan/
â”‚   â”œâ”€â”€ schema.md                          # âœ… v2.0 ì™„ë£Œ
â”‚   â”œâ”€â”€ v2.0-system-architecture.md        # âœ… ì´ ë¬¸ì„œ
â”‚   â”œâ”€â”€ complete-system-plan.md            # âœ… v2.0 ì™„ë£Œ
â”‚   â”œâ”€â”€ role-based-access-control.plan.md  # âœ… v2.0 ì™„ë£Œ
â”‚   â””â”€â”€ features/
â”‚       â”œâ”€â”€ gas-student-platform.plan.md   # âœ… v2.0 ì™„ë£Œ
â”‚       â””â”€â”€ student-crud.plan.md           # â³ v2.0 ì—…ë°ì´íŠ¸ í•„ìš”
â”‚
â””â”€â”€ 02-design/
    â”œâ”€â”€ features/
    â”‚   â”œâ”€â”€ gas-student-platform.design.md # â³ v2.0 ì—…ë°ì´íŠ¸ í•„ìš”
    â”‚   â”œâ”€â”€ student-crud.design.md         # â³ v2.0 ì—…ë°ì´íŠ¸ í•„ìš”
    â”‚   â””â”€â”€ role-based-access-control.design.md # â³ v2.0 ìƒì„± í•„ìš”
    â”‚
    â””â”€â”€ api/
        â”œâ”€â”€ signup-api.design.md           # â³ ì‹ ê·œ ìƒì„± í•„ìš”
        â”œâ”€â”€ email-api.design.md            # â³ ì‹ ê·œ ìƒì„± í•„ìš”
        â””â”€â”€ privacy-api.design.md          # â³ ì‹ ê·œ ìƒì„± í•„ìš”
```

---

## 4. ë°ì´í„° í”Œë¡œìš° (Data Flow)

### 4.1 í•™ìƒ íšŒì›ê°€ì… í”Œë¡œìš°

```
[í•™ìƒ] â”€â”€1. íšŒì›ê°€ì… í¼ ì‘ì„±â”€â”€â†’ [Signup.html]
             â”‚
             â”‚ 2. signupStudent() í˜¸ì¶œ
             â–¼
        [SignupService.gs]
             â”‚
             â”œâ”€â†’ 3. Users ì‹œíŠ¸ ì¤‘ë³µ í™•ì¸ (LoginID, Email)
             â”‚
             â”œâ”€â†’ 4. Students ì‹œíŠ¸ ì¤‘ë³µ í™•ì¸ (ê¸°ë³¸ ì •ë³´)
             â”‚
             â”œâ”€â†’ 5. StudentID ìƒì„± (generateStudentID)
             â”‚
             â”œâ”€â†’ 6. UserID ìƒì„± (STU + StudentID)
             â”‚
             â”œâ”€â†’ 7. ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ (hashPassword)
             â”‚
             â”œâ”€â†’ 8. Users ì‹œíŠ¸ ì €ì¥
             â”‚
             â”œâ”€â†’ 9. Students ì‹œíŠ¸ ì €ì¥
             â”‚
             â”œâ”€â†’ 10. PrivacyConsents ê¸°ë¡ (recordConsent)
             â”‚
             â”œâ”€â†’ 11. ì´ë©”ì¼ ì¸ì¦ ì½”ë“œ ë°œì†¡ (sendVerificationEmail)
             â”‚
             â””â”€â†’ 12. AuditLogs ê¸°ë¡ (SIGNUP)
                      â”‚
                      â–¼
[í•™ìƒ] â†â”€ 13. ê°€ì… ì™„ë£Œ ì•ˆë‚´ + ì´ë©”ì¼ ì¸ì¦ ìš”ì²­ â†â”€ [Signup.html]
```

### 4.2 ë¡œê·¸ì¸ í”Œë¡œìš° (3-tier Users)

```
[ì‚¬ìš©ì] â”€â”€1. LoginID + Password ì…ë ¥â”€â”€â†’ [Login.html]
              â”‚
              â”‚ 2. login() í˜¸ì¶œ
              â–¼
         [Auth.gs]
              â”‚
              â”œâ”€â†’ 3. Users ì‹œíŠ¸ì—ì„œ LoginID ì¡°íšŒ
              â”‚
              â”œâ”€â†’ 4. PasswordHash ê²€ì¦
              â”‚
              â”œâ”€â†’ 5. LoginAttempts í™•ì¸ (5íšŒ ì´í•˜)
              â”‚
              â”œâ”€â†’ 6. IsActive í™•ì¸
              â”‚
              â”œâ”€â†’ 7. ì„¸ì…˜ ìƒì„± (_createSession)
              â”‚       - ScriptCacheì— SESSION_{uuid} ì €ì¥
              â”‚       - TTL 1ì‹œê°„
              â”‚
              â”œâ”€â†’ 8. Users ì‹œíŠ¸ ì—…ë°ì´íŠ¸
              â”‚       - LastLogin ê°±ì‹ 
              â”‚       - LoginAttempts = 0
              â”‚
              â””â”€â†’ 9. AuditLogs ê¸°ë¡ (LOGIN)
                       â”‚
                       â–¼
[ì‚¬ìš©ì] â†â”€ 10. sessionId ë°˜í™˜ â†â”€ [Auth.gs]
              â”‚
              â”‚ 11. sessionStorage.setItem('sessionId', sessionId)
              â”‚
              â”‚ 12. UserTypeì— ë”°ë¼ ëŒ€ì‹œë³´ë“œ í‘œì‹œ
              â”‚     - master â†’ ì „ì²´ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ
              â”‚     - agency â†’ ì†Œì† í•™ìƒ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ
              â”‚     - student â†’ ë³¸ì¸ ì •ë³´ ì¡°íšŒ/ìˆ˜ì • í™”ë©´
              â–¼
         [Index.html]
```

### 4.3 ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° í”Œë¡œìš°

```
[ì‚¬ìš©ì] â”€â”€1. Email ì…ë ¥â”€â”€â†’ [ForgotPassword.html]
             â”‚
             â”‚ 2. requestPasswordReset() í˜¸ì¶œ
             â–¼
        [EmailService.gs]
             â”‚
             â”œâ”€â†’ 3. Users ì‹œíŠ¸ì—ì„œ Email ì¡°íšŒ
             â”‚
             â”œâ”€â†’ 4. ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ìƒì„± (8ìë¦¬ ëœë¤)
             â”‚
             â”œâ”€â†’ 5. Users ì‹œíŠ¸ PasswordHash ì—…ë°ì´íŠ¸
             â”‚
             â”œâ”€â†’ 6. ì´ë©”ì¼ ë°œì†¡ (sendPasswordReset)
             â”‚       Subject: "AJU E&J ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ë°œê¸‰"
             â”‚       Body: "ì„ì‹œ ë¹„ë°€ë²ˆí˜¸: ABC12345"
             â”‚
             â”œâ”€â†’ 7. EmailLogs ê¸°ë¡ (password_reset)
             â”‚
             â””â”€â†’ 8. AuditLogs ê¸°ë¡ (PASSWORD_RESET)
                      â”‚
                      â–¼
[ì‚¬ìš©ì] â†â”€ 9. "ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ê°€ ì´ë©”ì¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤" â†â”€ [ForgotPassword.html]
             â”‚
             â”‚ 10. ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸
             â”‚
             â”‚ 11. ë¡œê·¸ì¸ í›„ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ìš”ì²­ (ê°•ì œ)
             â–¼
        [Index.html]
```

### 4.4 ì •ê¸° ê°œì¸ì •ë³´ ì•Œë¦¼ í”Œë¡œìš° (ìë™í™”)

```
[GAS Time-driven Trigger] â”€â”€1. ë§¤ì¼ ìì • ì‹¤í–‰â”€â”€â†’ [PrivacyService.gs]
                                                      â”‚
                                                      â”‚ 2. sendScheduledPrivacyNotices()
                                                      â”‚
                                                      â”œâ”€â†’ 3. Users ì‹œíŠ¸ ì¡°íšŒ
                                                      â”‚     WHERE LastPrivacyNotice IS NULL
                                                      â”‚        OR LastPrivacyNotice < TODAY() - 180ì¼
                                                      â”‚
                                                      â”œâ”€â†’ 4. ëŒ€ìƒ ì‚¬ìš©ìë³„ ì´ë©”ì¼ ë°œì†¡
                                                      â”‚     Subject: "AJU E&J ê°œì¸ì •ë³´ ì´ìš© ì•ˆë‚´"
                                                      â”‚     Body: "ê·€í•˜ì˜ ê°œì¸ì •ë³´ê°€ ë‹¤ìŒê³¼ ê°™ì´ ì´ìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤..."
                                                      â”‚
                                                      â”œâ”€â†’ 5. Users ì‹œíŠ¸ ì—…ë°ì´íŠ¸
                                                      â”‚     - LastPrivacyNotice = TODAY()
                                                      â”‚
                                                      â”œâ”€â†’ 6. EmailLogs ê¸°ë¡ (privacy_notice)
                                                      â”‚
                                                      â””â”€â†’ 7. AuditLogs ê¸°ë¡ (PRIVACY_NOTICE_SENT)
```

---

## 5. ê¶Œí•œ ì œì–´ (Access Control Matrix v2.0)

### 5.1 ì—­í• ë³„ ê¶Œí•œ

| Role | Users | Students | Agencies | Consultations | ExamResults | PrivacyConsents | EmailLogs |
|------|-------|----------|----------|---------------|-------------|-----------------|-----------|
| **master** | ì „ì²´ CRUD | ì „ì²´ CRUD | ì „ì²´ CRUD | ì „ì²´ CRUD | ì „ì²´ CRUD | ì „ì²´ R | ì „ì²´ R |
| **agency** | ë³¸ì¸ R/U | ì†Œì† CRU | ë³¸ì¸ R/U | ì†Œì† CRU | ì†Œì† CRU | âŒ | âŒ |
| **student** | ë³¸ì¸ R/U | ë³¸ì¸ R/U | âŒ | ë³¸ì¸ R | ë³¸ì¸ R | ë³¸ì¸ R | ë³¸ì¸ R |

**Legend**:
- C: Create (ìƒì„±)
- R: Read (ì¡°íšŒ)
- U: Update (ìˆ˜ì •)
- D: Delete (ì‚­ì œ)
- âŒ: No Access (ì ‘ê·¼ ë¶ˆê°€)

### 5.2 ê¶Œí•œ ê²€ì¦ ë¡œì§

```javascript
// Auth.gs - checkPermission()
function checkPermission(sessionId, action, targetResourceId) {
  const session = _validateSession(sessionId);
  const userType = session.userType;
  const userId = session.userId;

  // masterëŠ” ëª¨ë“  ê¶Œí•œ
  if (userType === 'master') {
    return true;
  }

  // agencyëŠ” ì†Œì† í•™ìƒë§Œ
  if (userType === 'agency') {
    if (action === 'READ' || action === 'UPDATE' || action === 'CREATE') {
      // targetResourceIdê°€ ë³¸ì¸ ì†Œì†ì¸ì§€ í™•ì¸
      const targetAgencyCode = _getAgencyCodeByResourceId(targetResourceId);
      return targetAgencyCode === userId; // userId = AgencyCode
    }
    return false;
  }

  // studentëŠ” ë³¸ì¸ ë°ì´í„°ë§Œ
  if (userType === 'student') {
    if (action === 'READ' || action === 'UPDATE') {
      // targetResourceIdê°€ ë³¸ì¸ì¸ì§€ í™•ì¸
      return targetResourceId === userId; // userId = STU{StudentID}
    }
    return false;
  }

  return false; // ê¸°ë³¸ ê±°ë¶€
}
```

---

## 6. ë³´ì•ˆ ì •ì±… (Security Policy)

### 6.1 ì•”í˜¸í™” ê·œì¹™

| ë°ì´í„° | ì•”í˜¸í™” ë°©ì‹ | ì €ì¥ ìœ„ì¹˜ | ë¹„ê³  |
|--------|------------|----------|------|
| **ë¹„ë°€ë²ˆí˜¸** | SHA-256 + MASTER_SALT | Users.PasswordHash | GAS Utilities.computeDigest() |
| **í•™ë¶€ëª¨ ê²½ì œìƒí™©** | AES-256 | Students.ParentEconomicStatus | ENCRYPTION_KEYë¡œ ì•”í˜¸í™” |
| **ê°œì¸ì •ë³´ ë™ì˜ ë‚´ìš©** | í‰ë¬¸ | PrivacyConsents.ConsentText | ë²•ì  ì¦ë¹™ (ìˆ˜ì • ë¶ˆê°€) |

### 6.2 ì„¸ì…˜ ê´€ë¦¬

```
ì„¸ì…˜ ì €ì¥ì†Œ: ScriptCache (UserCache ì‚¬ìš© ê¸ˆì§€)
ì„¸ì…˜ TTL: 1ì‹œê°„ (3600ì´ˆ)
ì„¸ì…˜ ID í˜•ì‹: SESSION_{UUID}
ì„¸ì…˜ ë°ì´í„°: { userId, userType, agencyCode, loginId, createdAt }
```

### 6.3 ë¡œê·¸ì¸ ë³´ì•ˆ

```
ìµœëŒ€ ë¡œê·¸ì¸ ì‹œë„: 5íšŒ
ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ ì‹œ: ê³„ì • ì ê¸ˆ (Users.IsActive = FALSE)
ë¹„ë°€ë²ˆí˜¸ ìµœì†Œ ê¸¸ì´: 8ì
ë¹„ë°€ë²ˆí˜¸ ìš”êµ¬ì‚¬í•­: ì˜ë¬¸ + ìˆ«ì í˜¼í•©
```

---

## 7. ê°œì¸ì •ë³´ë³´í˜¸ë²• ì¤€ìˆ˜ (Privacy Compliance)

### 7.1 ë²•ì  ìš”êµ¬ì‚¬í•­

| ìš”êµ¬ì‚¬í•­ | êµ¬í˜„ ë°©ë²• | ì¦ë¹™ |
|---------|----------|------|
| **ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë™ì˜** | íšŒì›ê°€ì… ì‹œ ë™ì˜ ì²´í¬ë°•ìŠ¤ í•„ìˆ˜ | PrivacyConsents ì‹œíŠ¸ ê¸°ë¡ |
| **ì •ê¸°ì  ì´ìš© ì•Œë¦¼** | 6ê°œì›”ë§ˆë‹¤ ì´ë©”ì¼ ìë™ ë°œì†¡ | EmailLogs ì‹œíŠ¸ ê¸°ë¡ |
| **ê°œì¸ì •ë³´ ì—´ëŒ ê¶Œë¦¬** | í•™ìƒì´ ë³¸ì¸ ì •ë³´ ì¡°íšŒ ê°€ëŠ¥ | Students ì‹œíŠ¸ R ê¶Œí•œ |
| **ê°œì¸ì •ë³´ ìˆ˜ì • ê¶Œë¦¬** | í•™ìƒì´ ë³¸ì¸ ì •ë³´ ìˆ˜ì • ê°€ëŠ¥ | Students ì‹œíŠ¸ U ê¶Œí•œ |
| **ê°œì¸ì •ë³´ ì‚­ì œ ê¶Œë¦¬** | íšŒì› íƒˆí‡´ ì‹œ ì¦‰ì‹œ ì‚­ì œ | deleteStudent() í•¨ìˆ˜ |
| **ê°œì¸ì •ë³´ ì•”í˜¸í™”** | ë¯¼ê°ì •ë³´ AES-256 ì•”í˜¸í™” | ParentEconomicStatus ì•”í˜¸í™” |

### 7.2 SystemConfig ì¶”ê°€ í‚¤

```
privacy_policy               ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ ë³¸ë¬¸ (KR/VN)
consent_text_signup          íšŒì›ê°€ì… ì‹œ ë™ì˜ ë¬¸êµ¬ (KR/VN)
consent_text_renewal         ì¬ë™ì˜ ì‹œ ë¬¸êµ¬ (KR/VN)
privacy_notice_interval_days ì •ê¸° ì•Œë¦¼ ì£¼ê¸° (ê¸°ë³¸: 180ì¼)
consent_expiry_days          ë™ì˜ ìœ íš¨ ê¸°ê°„ (ê¸°ë³¸: 365ì¼)
password_reset_expiry_minutes ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ ê¸°ê°„ (ê¸°ë³¸: 60ë¶„)
```

---

## 8. êµ¬í˜„ ë‹¨ê³„ (Implementation Phases)

### 8.1 Phase 1 - í™˜ê²½ ì„¤ì • ë° ì¸ì¦ ì‹œìŠ¤í…œ (v1.0)

- [x] Node.js, clasp ì„¤ì¹˜
- [x] GAS í”„ë¡œì íŠ¸ ìƒì„±
- [x] Backend íŒŒì¼ ìƒì„± (8ê°œ)
- [x] Frontend íŒŒì¼ ìƒì„± (Login.html, Index.html)
- [x] Spreadsheet ìƒì„± (8 sheets - v1.0)
- [x] ì„¸ì…˜ ê´€ë¦¬ ì•„í‚¤í…ì²˜ ìˆ˜ì • (ScriptCache í†µì¼)
- [x] ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
- [ ] **v2.0 ë§ˆì´ê·¸ë ˆì´ì…˜** (ë‹¤ìŒ ë‹¨ê³„)

### 8.2 Phase 1.5 - v2.0 ë§ˆì´ê·¸ë ˆì´ì…˜ (ì‹ ê·œ)

#### 8.2.1 ë°ì´í„°ë² ì´ìŠ¤ í™•ì¥
- [ ] Users ì‹œíŠ¸ ìƒì„±
- [ ] PrivacyConsents ì‹œíŠ¸ ìƒì„±
- [ ] EmailLogs ì‹œíŠ¸ ìƒì„±
- [ ] Students ì‹œíŠ¸ UserID ì»¬ëŸ¼ ì¶”ê°€
- [ ] Agencies ì‹œíŠ¸ UserID ì»¬ëŸ¼ ì¶”ê°€
- [ ] ê¸°ì¡´ Agencies ë°ì´í„° â†’ Users ì‹œíŠ¸ ë§ˆì´ê·¸ë ˆì´ì…˜

#### 8.2.2 Backend ì„œë¹„ìŠ¤ ì¶”ê°€
- [ ] SignupService.gs ìƒì„±
  - signupStudent()
  - sendVerificationEmail()
  - verifyEmail()
- [ ] EmailService.gs ìƒì„±
  - sendWelcomeEmail()
  - sendPasswordReset()
  - sendIDRecovery()
  - sendPrivacyNotice()
- [ ] PrivacyService.gs ìƒì„±
  - recordConsent()
  - checkConsentExpiry()
  - sendConsentRenewal()

#### 8.2.3 Frontend í™”ë©´ ì¶”ê°€
- [ ] Signup.html (í•™ìƒ íšŒì›ê°€ì… í¼)
- [ ] ForgotPassword.html (ID/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°)
- [ ] Login.html ìˆ˜ì • (íšŒì›ê°€ì… ë§í¬ ì¶”ê°€)

#### 8.2.4 ê¶Œí•œ ì œì–´ ìˆ˜ì •
- [ ] Auth.gs ìˆ˜ì • (3-tier ì‚¬ìš©ì ì§€ì›)
- [ ] StudentService.gs ìˆ˜ì • (student ê¶Œí•œ ì¶”ê°€)
- [ ] checkPermission() ë¡œì§ í™•ì¥

#### 8.2.5 i18n í‚¤ ì¶”ê°€
- [ ] íšŒì›ê°€ì… ê´€ë ¨ í‚¤ (25ê°œ)
- [ ] ì´ë©”ì¼ ê´€ë ¨ í‚¤ (20ê°œ)
- [ ] ê°œì¸ì •ë³´ë³´í˜¸ ê´€ë ¨ í‚¤ (15ê°œ)

#### 8.2.6 ìë™í™” íŠ¸ë¦¬ê±° ì„¤ì •
- [ ] GAS Time-driven Trigger ì¶”ê°€
  - ë§¤ì¼ ìì • ì •ê¸° ê°œì¸ì •ë³´ ì•Œë¦¼ ë°œì†¡

### 8.3 Phase 2~9 (ê¸°ì¡´ ê³„íš)

- Phase 2: ì½”ë“œ ì‘ì„± (âœ… ì™„ë£Œ - v1.0)
- Phase 3: ê°ì‚¬ ë¡œê·¸ (âœ… ì™„ë£Œ - v1.0)
- Phase 4: í•™ìƒ CRUD UI
- Phase 5: ìƒë‹´/ì‹œí—˜ ê´€ë¦¬
- Phase 6: í–‰ì • ì •ë³´
- Phase 7: UI/UX ì™„ì„±
- Phase 8: í†µí•© í…ŒìŠ¤íŠ¸
- Phase 9: ë°°í¬

---

## 9. ëª¨ë“ˆ ì˜ì¡´ì„± (Module Dependencies)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Code.gs       â”‚ â† ì§„ì…ì  (doGet, include)
â”‚  (ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚   Config.gs     â”‚ â† ëª¨ë“  ëª¨ë“ˆì´ ì°¸ì¡°
         â”‚    â”‚  (ì„¤ì • ìƒìˆ˜)     â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚   Auth.gs       â”‚ â† ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ì˜ì¡´
         â”‚    â”‚  (ì¸ì¦/ê¶Œí•œ)     â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚             â”‚
         â”‚             â”œâ”€â”€â†’ SignupService.gs (íšŒì›ê°€ì…)
         â”‚             â”‚
         â”‚             â”œâ”€â”€â†’ StudentService.gs (í•™ìƒ CRUD)
         â”‚             â”‚
         â”‚             â”œâ”€â”€â†’ ConsultService.gs (ìƒë‹´)
         â”‚             â”‚
         â”‚             â””â”€â”€â†’ ExamService.gs (ì‹œí—˜)
         â”‚
         â”œâ”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚ EmailService.gs â”‚ â† SignupService, PrivacyService ì˜ì¡´
         â”‚    â”‚  (ì´ë©”ì¼ ë°œì†¡)    â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚ PrivacyService.gsâ”‚ â† SignupService ì˜ì¡´
         â”‚    â”‚ (ê°œì¸ì •ë³´ ê´€ë¦¬)    â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚ I18nService.gs  â”‚ â† ëª¨ë“  HTML íŒŒì¼ì´ ì˜ì¡´
         â”‚    â”‚  (ë‹¤êµ­ì–´ ì—”ì§„)    â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚ AuditService.gs â”‚ â† ëª¨ë“  ì„œë¹„ìŠ¤ê°€ í˜¸ì¶œ
         â”‚    â”‚  (ê°ì‚¬ ë¡œê·¸)      â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â””â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Helpers.gs    â”‚ â† ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ì‚¬ìš©
              â”‚  (ìœ í‹¸ë¦¬í‹°)      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. ë‹¤ìŒ ì‘ì—… ê³„íš (Next Steps)

### ìš°ì„ ìˆœìœ„ 1 (í•„ìˆ˜)
1. **Design ë¬¸ì„œ ì—…ë°ì´íŠ¸**
   - student-crud.plan.md v2.0 ì—…ë°ì´íŠ¸
   - gas-student-platform.design.md v2.0 ì—…ë°ì´íŠ¸
   - student-crud.design.md v2.0 ì—…ë°ì´íŠ¸

2. **ì‹ ê·œ Design ë¬¸ì„œ ì‘ì„±**
   - signup-api.design.md (íšŒì›ê°€ì… API ì„¤ê³„)
   - email-api.design.md (ì´ë©”ì¼ ì„œë¹„ìŠ¤ API ì„¤ê³„)
   - privacy-api.design.md (ê°œì¸ì •ë³´ ê´€ë¦¬ API ì„¤ê³„)
   - role-based-access-control.design.md (3-tier ê¶Œí•œ ì„¤ê³„)

### ìš°ì„ ìˆœìœ„ 2 (êµ¬í˜„)
3. **Phase 1.5 ì‹¤í–‰**
   - Users, PrivacyConsents, EmailLogs ì‹œíŠ¸ ìƒì„±
   - SignupService.gs, EmailService.gs, PrivacyService.gs ì½”ë“œ ì‘ì„±
   - Signup.html, ForgotPassword.html í™”ë©´ ì‘ì„±
   - i18n í‚¤ 60ê°œ ì¶”ê°€

4. **í…ŒìŠ¤íŠ¸ ë° ê²€ì¦**
   - í•™ìƒ íšŒì›ê°€ì… í”Œë¡œìš° í…ŒìŠ¤íŠ¸
   - ì´ë©”ì¼ ë°œì†¡ í…ŒìŠ¤íŠ¸
   - ê¶Œí•œ ì œì–´ í…ŒìŠ¤íŠ¸

---

## 11. ì°¸ê³  ìë£Œ (References)

### ë¬¸ì„œ
- [schema.md](./schema.md) - v2.0 ë°ì´í„° êµ¬ì¡° ì •ì˜
- [complete-system-plan.md](./complete-system-plan.md) - v2.0 ì „ì²´ ê³„íš
- [role-based-access-control.plan.md](./role-based-access-control.plan.md) - v2.0 ê¶Œí•œ ì œì–´

### GAS í”„ë¡œì íŠ¸
- í”„ë¡œì íŠ¸ ID: `1j1tnoI_AHuxe624nn5ET3s7oizWFmOKkkQp7YuoKK02DLr_tOQkmlscN`
- URL: https://script.google.com/d/1j1tnoI_AHuxe624nn5ET3s7oizWFmOKkkQp7YuoKK02DLr_tOQkmlscN/edit

---

**ì‘ì„±ì**: Claude AI
**ê²€í† ì**: ì‚¬ìš©ì (duyang22@gmail.com)
**ìŠ¹ì¸ ìƒíƒœ**: ì´ˆì•ˆ (Review ëŒ€ê¸°)

*Generated by bkit PDCA System v2.0*
